<div class="sidebar-header">
  <h2>Sessions</h2>
  <div class="new-session-wrapper">
    <button class="btn-new"
            (click)="showDropdown = !showDropdown"
            [disabled]="!sessionService.connected()"
            title="New Session">+</button>
    @if (showDropdown) {
      <div class="new-dropdown">
        <button class="dropdown-item" (click)="quickCreate('terminal')">
          <span class="dropdown-icon">&#9002;</span> Terminal
        </button>
        <button class="dropdown-item" (click)="quickCreate('stream')">
          <span class="dropdown-icon">&#8644;</span> Stream
        </button>
      </div>
    }
  </div>
</div>

@if (!sessionService.connected()) {
  <div class="connecting">Connecting to server...</div>
}

<div class="session-list">
  @for (group of groupedSessions(); track group.label) {
    <div class="session-group">
      <div class="group-header">{{ group.label }}</div>
      @for (session of group.sessions; track session.id) {
        <div class="session-card"
             [class.active]="session.id === sessionService.activeSessionId()"
             [class.card-active-llm]="getActivity(session.id) === 'busy' || getActivity(session.id) === 'tool_use'"
             [class.card-unread]="isUnread(session.id)"
             (click)="select(session.id)">
          <div class="card-top">
            <span class="status-indicator" [ngClass]="getDotState(session)">
              @if (getActivity(session.id) === 'busy' || getActivity(session.id) === 'tool_use') {
                <span class="dot-triple"><span></span><span></span><span></span></span>
              }
            </span>
            <span class="session-name">#{{ session.number }} {{ session.name }}</span>
            <button class="btn-remove" (click)="remove($event, session.id)" title="Remove">&times;</button>
          </div>
          <div class="card-bottom">
            <span class="session-dir">{{ session.workingDirectory }}</span>
            <span class="session-mode-tag" [ngClass]="session.mode">{{ session.mode }}</span>
          </div>
        </div>
      }
    </div>
  }

  @if (sessionService.connected() && sessionService.sessions().length === 0) {
    <div class="empty-hint">No sessions yet. Click + to create one.</div>
  }
</div>
